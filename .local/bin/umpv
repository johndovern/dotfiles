#!/bin/sh

umpvsocket="/tmp/mpvSockets/umpv_socket"
if [ -S "$umpvsocket" ]; then
  mpv-communicate "$umpvsocket" '{ "command": ["loadfile", "'$1'", "append-play"] }' >/dev/null 2>&1 && notify-send "Video Added" "$1"
    if mpv-communicate "$umpvsocket" '{ "command": ["get_property", "eof-reached"] }' | grep -q ":true" >/dev/null 2>&1; then
      mpv-communicate "$umpvsocket" '{ "command": ["playlist-next"] }'
      sleep 2
      mpv-communicate "$umpvsocket" 'cycle pause'
    fi
else
  mpv --idle=yes --no-terminal --x11-name=umpv --force-window --loop-playlist=no --keep-open=yes --input-ipc-server="$umpvsocket" "$1" >/dev/null 2>&1
fi
