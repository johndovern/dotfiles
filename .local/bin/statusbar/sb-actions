#!/bin/sh

play_music() { \
  # while read -r list; do
  #   playlist+=("${list%%.m3u}")
  # done <<<$(find $XDG_CONFIG_HOME/mpd/playlists -type f -printf '%P\n')
  # play=$(printf '%s\n' "${playlist[@]}" | dmenu -i -p "Playlist:")
  play=$(find $XDG_CONFIG_HOME/mpd/playlists -type f -printf '%P\n' | sed 's/\.m3u//g' | dmenu -i -p "Playlist:")
  case "${play}" in
    "") ;;
    *) mpc clear && mpc load "$play" >/dev/null 2>&1 && mpc random off >/dev/null 2>&1 && mpc repeat on >/dev/null 2>&1 && mpc play >/dev/null 2>&1 && mpc random on >/dev/null 2>&1 ;;
  esac
}

case $BLOCK_BUTTON in
  1) open=$(printf "Music\\nWindows\\nmpv-options\\nQute\\nPcmanfm\\nSysact\\nExit" | dmenu -i -p "Open:")
    case "$open" in
      "Music") play_music ;;
      "Windows") dmenuwindows ;;
      "mpv-options") mpv-options;;
      "Qute")
        if pidof -qx qutebrowser ; then
          wmctrl -xa "qutebrowser"
        else
          setsid -f qutebrowser
        fi ;;
      "Pcmanfm") setsid -f pcmanfm ;;
      "Sysact") setsid -f sysact ;;
      "Exit") ;;
      *) ;;
    esac ;;
  2) notify-send "Action module" "\- Open useful programs.
- Left click to pick options
- Middle click shows this box.
- Right click to pick a playlist
- Scroll up to manipulate windows
- Scroll down for system control" ;;
  3) play_music ;;
  4) dmenuwindows ;;
  5) setsid -f sysact ;;
  *) ;;
esac

echo -e "[+]"
