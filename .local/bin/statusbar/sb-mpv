#!/bin/sh

socket="/tmp/mpvSockets/mpv_music"

mpv_display() {
  if [ -S "$socket" ] ; then
    if mpv-currently-playing --music >/dev/null 2>&1; then
      case "$1" in
        -u)
          song=$(mpv-get-property "$socket" "playlist/$(mpv-get-property $socket 'playlist-pos')/title")
          ;;
        *)
          song=$(mpv-get-property "$socket" "playlist/$(mpv-get-property $socket 'playlist-pos')/title" | cut -b -22 | sed 's/\s*.$/.../')
          paused=''
          ;;
      esac
    else
      song=''
      paused="mpv"
    fi
  else
    song="/"
    paused=''
  fi
  printf '%s\n' "[$song$paused]"
}

case $BLOCK_BUTTON in
  1) mpv-communicate "$socket" "cycle pause" ;; # mpv_display ;;
  2) mpv-communicate "$socket" '{ "command": ["script-binding", "playlistmanager/shuffleplaylist"] }' ;;
  3) notify-send "$(mpv_display -u)" ;;
  4) mpv-prev-song ;;
  5) mpv-next-song ;;
  6) yt-opts -a "$(mpv-get-property "$socket" "playlist/$(mpv-get-property $socket 'playlist-pos')/filename")" ;;
  *) mpv_display ;;
esac
