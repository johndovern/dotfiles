#!/bin/sh

SOCKET="${MPV_MUSIC_SOCKET:-${MPV_SOCKET_DIR:-/tmp/mpvSockets}/music_socket}"
if [ ! -S "${SOCKET}" ] ; then
  exit
fi

mpv_display() {
  if mpv-currently-playing --music >/dev/null 2>&1; then
    case "$1" in
      -u)
        SONG=$(mpv-get-property "${SOCKET}" "media-title")
        ;;
      *)
        SONG=$(mpv-get-property "${SOCKET}" "media-title" | cut -b -22 | sed 's/\s*.$/.../')
        PAUSED=''
        ;;
    esac
  else
    SONG=''
    PAUSED="mpv"
  fi
  printf '%s\n' "[${SONG}${PAUSED}]"
}

case $BLOCK_BUTTON in
  1)
    mpv-toggle --music
    mpv_display
    ;;
  2)
    mpv-opts --quit --music
    mpv_display
    ;;
  3)
    notify-send "$(mpv_display -u)"
    mpv_display
    ;;
  4)
    mpv-prev --music
    mpv_display
    ;;
  5)
    mpv-next --music
    mpv_display
    ;;
  6)
    yt-opts "$(mpv-get-property --music "path")"
    mpv_display
    ;;
  *)
    mpv_display
    ;;
esac
