#!/bin/sh

filter() {
  if mpc | grep -q "\[paused\]" ; then
    song=
    paused="Paused"
  elif mpc | grep -q "volume: n/a   r" ; then
    song=
    paused="Music"
  else
    song="$(mpc | head -n1 | cut -b -22 | sed 's/\s*.$/.../')"
    paused=
  fi
  printf '%s%s%s%s\n' "[" "$song" "$paused" "]"
}

unfilter() { mpc | head -n1;}

pidof -x sb-mpdup >/dev/null 2>&1 || sb-mpdup >/dev/null 2>&1 &

case $BLOCK_BUTTON in
	1) mpc toggle | filter ;;  # right click, pause/unpause
	2) mpc status | filter ; setsid -f "$TERMINAL" -e ncmpcpp ;;  # right click, pause/unpause
  3) mpc status | filter ; notify-send "$(mpc status | unfilter)" ;;
	# 3) mpc status | filter ; notify-send "Music module" "\- Shows mpd song playing.
# - [Paused] when paused.
# - Left click pauses.
# - Middle click opens ncmpcpp.
# - Right click displays this message
# - Scroll changes track.";;  # right click, pause/unpause
	4) mpc prev   | filter ;;  # scroll up, previous
	5) mpc next   | filter ;;  # scroll down, next
	6) mpc status | filter ; "$TERMINAL" -e "$EDITOR" "$0" ;;
	*) mpc status | filter ;;
esac
